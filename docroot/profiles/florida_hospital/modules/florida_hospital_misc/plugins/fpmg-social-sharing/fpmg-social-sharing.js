/*jslint bitwise: true, eqeqeq: true, immed: true, newcap: true, nomen: false,
 onevar: false, plusplus: false, regexp: true, undef: true, white: true, indent: 2
 browser: true */

/*global jQuery: true Drupal: true window: true document: true */

/**
 * Creates a region for social sharing links
 */
(function ($, Drupal, window, document) {


// Builds div wrapper structure for social sharing links
  function socialSharingTemplate() {
    var $tmpl = $('<div>', {
      id: 'social-sharing-links',
      html: $('<div>').addClass('social-sharing-links')
    });
    return $tmpl.addClass('tmpl-tracer');
  }

// Load Facebook resoures
  function facebook(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }
  }

// Load Google+ resources
  function google() {
    var po = document.createElement('script');
    po.type = 'text/javascript';
    po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  }

// Load Twitter resources
  function twitter(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id = id;
      js.src = "//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);
    }
  }

// Create and store the Facebook, Google+, and Twitter sharing links
  Drupal.behaviors.fpmgSocialSharing = {
    attach: function (context, settings) {
      $('body').once('social-sharing', function (index) {
        var $target, $breadcrumb, $socialSharingLinks;
        $socialSharingLinks = $('<div>');

        // Social sharing region label text
        $('<p>', {
          text: Drupal.t('Share This Page')
        })
        .appendTo($socialSharingLinks);

        // Twitter "Share" links
        $('<a>', {
          'data-count': 'none',
          'data-size': '54',
          href: 'https://twitter.com/share'
        })
        .addClass('twitter-share-button')
        .appendTo($socialSharingLinks);
        // Ensures that the Twitter javascript is only called once. If the twtter
        // object generated by the javascript already exists, it will not be called.
        if (window.twtter === undefined) {
          twitter(document, "script", "twitter-wjs");
        }

        // Google+ links
        $('<div>', {
          'data-annotation': 'none',
          'data-size': 'medium'
        })
        .addClass('g-plusone')
        .appendTo($socialSharingLinks);
        // Ensures that the Google+ javascript is only called once. If the gapi
        // object generated by the javascript already exists, it will not be called.
        if (window.gapi === undefined) {
          google();
        }

        // Facebook "Like" and "Send" links
        $('<div>', {
          id: 'fb-root'
        })
        .prependTo('body');
        $('<div>', {
          'data-layout': 'button_count',
          'data-send': 'true',
          'data-width': '153',
          'data-show-faces': 'false'
        })
        .addClass('fb-like')
        .appendTo($socialSharingLinks);
        // Ensures that the Facebook javascript is only called once. If the FB object
        // generated by the javascript already exists, it will not be called.
        if (window.FB === undefined) {
          facebook(document, 'script', 'facebook-jssdk');
        }

        // If the breadcrumb is active, add the social sharing links beneath them.
        $breadcrumb = $('#breadcrumb-region');
        if ($breadcrumb.length > 0) {
          $('#breadcrumb-region').addClass('social-sharing-links-present');
          $socialSharingLinks.wrapAll(socialSharingTemplate())
          .closest('.tmpl-tracer')
          .removeClass('tmpl-tracer')
          .hide()
          .insertAfter('#breadcrumb-region')
          .fadeIn();
        }
      });
    }
  };
}(jQuery, Drupal, window, document));
